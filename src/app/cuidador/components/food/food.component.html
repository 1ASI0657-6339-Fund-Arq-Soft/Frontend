<app-cuidador-layout>
  <div class="food-admin">
    <h2 class="title">Gestión de Alimentos</h2>

    <div class="form card">
      <h3 class="section-title">{{ editingId ? 'Editar Registro' : 'Nuevo Registro' }}</h3>

      <label>Destinatario</label>
      <select [(ngModel)]="selectedFamiliaId">
        <option [value]="null">Seleccione un familiar</option>
        <option *ngFor="let f of familiares" [value]="f.id">
          {{ (f.fullName?.firstName || '') + ' ' + (f.fullName?.lastName || '') }} 
          ({{ f.relationship || 'Familiar' }})
        </option>
      </select>

      <label>Comida</label>
      <select [(ngModel)]="meal">
        <option value="BREAKFAST">Desayuno</option>
        <option value="LUNCH">Almuerzo</option>
        <option value="DINNER">Cena</option>
      </select>

      <label>Descripción</label>
      <input type="text" [(ngModel)]="description" placeholder="Ej. Pan con queso, jugo de naranja" />

      <div class="grid-2">
        <div>
          <label>Fecha</label>
          <input type="date" [(ngModel)]="date" />
        </div>

        <div>
          <label>Hora</label>
          <input type="time" [(ngModel)]="time" />
        </div>
      </div>

      <button class="btn btn-primary" (click)="save()">
        {{ editingId ? 'Guardar Cambios' : 'Agregar Registro' }}
      </button>
    </div>

    <div class="entries">
      <h3 class="section-title">Historial de alimentos</h3>

      @for (e of entries; track e.id) {
        <div class="card entry">
          <div class="entry-left">
            <div class="entry-meal">{{ getMealDisplayName(e.meal) }}</div>
            <div class="entry-desc">{{ e.description }}</div>
            @if (e.targetId) {
              <div class="entry-target">
                <strong>Para:</strong> {{ getFamiliarName(e.targetId) }}
              </div>
            }
          </div>

          <div class="entry-right">
            <div class="entry-datetime">
              {{ e.date }} • <span>{{ e.time }}</span>
            </div>

            <div class="entry-actions">
              <button class="btn btn-small" (click)="startEdit(e)">Editar</button>
              <button class="btn btn-danger btn-small" (click)="remove(e.id)">Eliminar</button>
            </div>
          </div>
        </div>
      }
    </div>
  </div>
</app-cuidador-layout>
