<app-cuidador-layout>
  <div class="payments-dashboard">

    <h2 class="title">Gestión de Pagos</h2>

    <div class="card create-form">
      <h3 class="section-title">Crear nueva solicitud</h3>

      <div class="form-group">
        <label>Destinatario</label>
        <div *ngIf="loadingFamiliares">Cargando familiares…</div>
        <div *ngIf="backendErrorFamiliares" class="text-warning">{{ backendErrorFamiliares }}</div>
        <select [(ngModel)]="selectedFamiliaId">
          <option value="">Seleccione un familiar</option>
          <option *ngFor="let f of familiares" [value]="f.id">{{ f.name }}</option>
        </select>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Periodo</label>
          <input type="text" [(ngModel)]="period" placeholder="Ejem: Enero 2025" />
        </div>

        <div class="form-group">
          <label>Monto</label>
          <input type="number" [(ngModel)]="amount" placeholder="S/ 0.00" />
        </div>
      </div>

      <div class="form-group">
        <label>Concepto</label>
        <input type="text" [(ngModel)]="concept" placeholder="Cuidado semanal, etc." />
      </div>

      <button class="btn btn-primary" (click)="createRequest()">Crear Solicitud</button>
    </div>

    <div class="requests-list">
      <h3 class="section-title">Solicitudes registradas</h3>

      <div *ngIf="payments.length === 0" class="empty">
        No hay solicitudes creadas.
      </div>

      <div *ngFor="let p of payments" class="card request-item">
        <div class="request-header">
          <div class="request-info">
            <span class="request-title">{{ p.concept }}</span>
            <span class="request-amount">S/ {{ p.amount }}</span>
          </div>
          <span class="status" [ngClass]="p.status">{{ p.status }}</span>
        </div>

        <div class="request-meta">
          <span class="tag">{{ p.period }}</span>
          <span class="date">{{ p.createdAt | date:'short' }}</span>
        </div>

        <div class="request-actions">
          <button class="btn btn-light" (click)="editPayment(p)">Editar</button>
          <button class="btn btn-danger" (click)="deletePayment(p)">Eliminar</button>

          <button *ngIf="p.status !== 'paid'" class="btn btn-success" (click)="payNow(p)">
            Simular Pago
          </button>

          <a *ngIf="p.receiptUrl" class="btn btn-primary" [href]="p.receiptUrl" target="_blank">
            Ver Recibo
          </a>
        </div>
      </div>
    </div>

  </div>
</app-cuidador-layout>
