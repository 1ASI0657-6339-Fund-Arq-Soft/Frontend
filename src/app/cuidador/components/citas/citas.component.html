<app-cuidador-layout>
  <div class="citas-page">

    <div class="page-header">
      <h2 class="page-title">Gestión de Citas</h2>
      <button class="btn-primary" (click)="openCreateModal()">+ Nueva Cita</button>
    </div>
    <div class="citas-list">
      <div *ngFor="let c of (appointments$ | async)" class="cita-card">

        <div class="cita-info">
          <h3 class="cita-title">Cita #{{ c.id }}</h3>
          <p class="cita-meta">Fecha: {{ c.date }}</p>
          <p class="cita-meta">Hora: {{ c.time?.hour || 0 }}:{{ c.time?.minute || '00' }}</p>

          <p class="cita-specialty" *ngIf="c.status">
            <strong>Estado:</strong> {{ c.status }}
          </p>

          <p><strong>Paciente:</strong> {{ c.residentId }}</p>
          <p><strong>Médico:</strong> {{ c.doctorId }}</p>
        </div>

        <div class="cita-actions">
          <button class="btn-secondary" (click)="viewAppointment(c)">Ver</button>
          <button class="btn-secondary" (click)="editAppointment(c)">Editar</button>
          <button class="btn-danger" (click)="deleteAppointment(c.id)">Eliminar</button>
          <button class="btn-success" (click)="finalizeAppointment(c.id)">Finalizar</button>
        </div>
      </div>
    </div>
    <div *ngIf="showModal" class="modal-overlay">
      <div class="modal-card">

        <h3 class="modal-title">
          {{ selectedAppointment ? "Editar Cita" : "Nueva Cita" }}
        </h3>

        <form [formGroup]="appointmentForm" (ngSubmit)="saveAppointment()" class="modal-form">

          <label>Paciente (ID)</label>
          <select formControlName="residentId" class="form-input">
            <option value="">Seleccione residente</option>
            <option *ngFor="let r of residents" [value]="r.id">{{ r.firstName }} {{ r.lastName }}</option>
          </select>

          <label>Médico (ID)</label>
          <select formControlName="doctorId" class="form-input">
            <option value="">Seleccione médico</option>
            <option *ngFor="let d of doctors" [value]="d.id">{{ d.fullName?.firstName }} {{ d.fullName?.lastName }}</option>
          </select>

          <label>Fecha</label>
          <input type="date" formControlName="date" class="form-input"/>

          <label>Hora - Hora</label>
          <input type="number" min="0" max="23" formControlName="timeHour" class="form-input"/>

          <label>Hora - Minuto</label>
          <input type="number" min="0" max="59" formControlName="timeMinute" class="form-input"/>

          <label>Estado</label>
          <select formControlName="status" class="form-input">
            <option value="pending">pending</option>
            <option value="accepted">accepted</option>
            <option value="rejected">rejected</option>
            <option value="finalized">finalized</option>
          </select>

          <div class="modal-actions">
            <button type="submit" class="btn-primary">Guardar</button>
            <button type="button" class="btn-secondary" (click)="closeModal()">Cancelar</button>
          </div>

        </form>
      </div>
    </div>

  </div>
</app-cuidador-layout>
